---
title: "Detection of consensus peak regions inside a group of experiences using narrowPeak data"
output:
  BiocStyle::html_document:
    toc: true
bibliography: consensusSeekeR.bib
vignette: >
  %\VignetteIndexEntry{Detection of consensus peak regions inside a group of experiences using narrowPeak files}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignettePackage{consensusSeekeR}
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown()
```

<br />

Authors: Astrid Louise Deschenes, Fabien Claude Lamaze, Pascal Belleau 
and Arnaud Droit <br />
Compilation date: `r Sys.Date()`


## Licensing

This package and the underlying `consensusSeekeR` code are distributed 
under the Artistic license 2.0. You are free to use and redistribute this 
software.


## Introduction

The genome is commonly represented as a linear sequence, split up in 
multiple chromosomes. Genome data, such as genes, nucleosomes or 
single-nucleotide polymorphisms (SNPs) are linked to the genome by 
occupying either a range of 
positions or a single position on the sequence. Genomic related data 
integration is made possible by treating the data as 
ranges on the genome, which acts as a common scaffold [@Lawrence2013]. 
Bioconductor as developed an infrastructure, including packages such as 
`r Biocpkg("GenomicRanges")`,  `r Biocpkg("IRanges")` and 
`r Biocpkg("GenomicFeatures")`, to facilitate 
the integrative statistical analysis of range-based genomic data.

Ranges have a fundamental role in the analysis of experimental data. As 
an example, the peak calling step, in the analysis of ChIP-seq data, generally
generated narrow peaks outputs, used by the ENCODE project [@Dunham2012a], 
which include a peak position located inside 
a genomic range. Even more, the analysis of gene expression, using RNA-seq 
data, is based on counting the alignments overlapping exons which can be 
translated as genomic ranges.

In genomic analysis where feature identification generate a position value 
surrounded by a genomic range, such as in ChIP-Seq and nucleosome postioning, 
the replication of the analyses may result in slight differences between 
predicted values. Conciliation of the results can be difficult, especially 
when many replicates are done.

One approach often used to identify consensus in a group of results consist of 
using the overlapping regions of the genomic ranges. This approach, when use on
a large group of experiments, can miss, as a side effect, regions when one of 
the experiment has missing features or slightly shift ones. On the other hand,
the use of the union of the regions cans result in wide consensus ranges.

The `consensusSeekeR` package implements a novative way to identify consensus 
ranges in a group of experiments which generated position values
surrounded by a genomic ranges. The `consensusSeekeR` package is characterized 
by its use of the position values, instead of the genomic range, to identify
the consensus regions.

## The consensusSeekeR package

The `consensusSeekeR` package implements a novative way to identify consensus 
ranges in a group of experiments which generated position values
surrounded by a genomic ranges. The `consensusSeekeR` package is characterized 
by its use of the position values, instead of the genomic range, to identify
the consensus regions.

Using iterative steps on ordered position values from all experiments which 
have not been yet associated to a consensus region, a window of fixed size 
(specified by user) with the position value as starting point is set. All 
position values which reside inside the window are gathered to calculate the 
median position which is then used to recreate a new window. This time, the 
new window has twice the size fixed by user and its center is the median. An 
update of the position values residing inside the window is done and a new 
median position is calculated. This step is repeated up to the moment that 
the set of position values become stable. The final set of position values is
used to set the central position of the consensus region. This consensus 
region must respect the minimum number of experiments that must have at least 
on inside it to be retained as an final consensus region. The minimum number 
of experiments is set by the user. At last, the final consensus region can be
extended or shrinked to fit the regions associated to the position values 
present inside. If new position values are added during the extension, the
extension step is not reprocess to include those new position
values.


## Loading consensusSeekeR package

As with any R package, the `consensusSeekeR` package should first be loaded 
with the following command:

```{r loadingPackage, warning=FALSE, message=FALSE}
library(consensusSeekeR)
```

## Inputs


## Using consensusSeekeR on nucleosome positions data   

Global gene expression patterns are established and maintained by the 
concerted actions of Transcription Factors (TFs) and the proteins that 
constitute chromatin. The key structural element of chromatin is the 
nucleosome, which consists of an octameric histone core wrapped by 146 bps 
of DNA and connected to its neighbor by approximately 10-80 pbs of linker 
DNA (reference TODO). Nucleosome occupancy and positioning have proved to be 
dynamic. It also have a major impact on expression, regulation, and evolution 
of eukaryotic genes

### Comparing nucleosome positioning results

## Using consensusSeekeR on ChIP-Seq data

Next-generation DNA sequencing coupled with chromatin immunoprecipitation 
(ChIP-seq) has changed the ability to interrogate whole genome protein-DNA 
interactions by enabeling  genomic localization of histone 
modifications and transcription-factor binding in living cells. Consortium, 
such as [ENCODE](https://www.encodeproject.org) have developed, and 
constantly upgrading, a set of standards and guidelines for ChIP experiments 
[@Landt2012].

ChIP-seq combines chromatin immunoprecipitation (ChIP) with massively parallel 
DNA sequencing to identify the binding sites of DNA-associated proteins. The
obtained sequence reads are first mapped to the reference genome of the 
organism used in the experiments. Bindind sites are them dectected by using
software specialized in transcript factor binding sites identification, such 
MACS [@Zhang2008] and PeakRanger [@Feng2011]. Peaks
are defined as a single base pair position.

### ChIP-Seq replicates from one experiment

The Encyclopedia of DNA Elements (ENCODE) Consortium is an international 
collaboration of research groups funded by the National Human Genome Research 
Institute. The [ENCODE website](https://www.encodeproject.org) is a portal 
giving access to the data generated by the ENCODE Consortium. The amount of 
data gathered is extensive. Moreover, for one specific experiment, more than 
one ChIP-Seq replicate is often available.

The software used to identify transcript factor binding sites generally 
generates a peak position and a narrow region region for each binding site. 
However, it is quite unlikely that the exact peak position is exactly the same 
across replicates. Even more, there is not yet a consent on how to analyze 
multiple-replicate ChIP-seq samples [@Yang2014].

The `consensusSeekeR` package can be used to identify consensus regions for
two or more replicates ChIP-Seq samples. The consensus regions are being found 
by using the peak positions.

The transcription factor binding for the CTCF transcription factor have been
analyzed and 2 replicates are available in BAM files format on 
[ENCODE website](https://www.encodeproject.org) (DCCs: 
ENCFF000MYJ and ENCFF000MYN). (TODO FABIEN : ajouter une courte description 
sur la methode pour obtenir narrowPeaks). 

To simplify this demo, only part of chromosomes X and Y have been retained in 
thedatasets. 

First, the `consensusSeekeR` package must be loaded.

```{r libraryLoad, warning=FALSE, message=FALSE}
library(consensusSeekeR)
```

### ChIP-Seq data from multiple experiments

The `consensusSeekeR` package can also be used to identify consensus regions 
for two or more ChIP-Seq samples from multiple experiments. While the 
consensus regions are being found by using the peak positions, the TODO.

The transcription factor binding for the CTCF transcription factor have been
analyzed and 2 replicates are available in BAM files format on 
[ENCODE website](https://www.encodeproject.org) (DCCs: 
ENCFF000MYJ and ENCFF000MYN) [@Dunham2012]. (TODO FABIEN : ajouter une courte 
description 
sur la methode pour obtenir narrowPeak).

## Effect of the extendingSize parameter

The value of the `extendingSize` parameter can affect the final number of 
consensus regions. While small `extendingSize` value can miss some regions, 
large `extendingSize` value can gather consensus regions.

##  Parallelizing consensusSeekeR

Due to the size of the analyzed genomes, the `findConsensusPeakRegions` 
function can take long to process.  However, a job can be separated by 
chromosome and run in parallel. This takes advantage of multiple 
processors and reduce the total execution time. This number of threads 
used by the  can be set with
the `minNbrExp` parameter in the `findConsensusPeakRegions` function. However, 
Windows does not support multicore evaluation.

## References

